
{% extends "base.html" %}

{% block title %}ุจุงุฑฺฏุฐุงุฑ ูุงู ZIP ุญุงู ุชุตุงูุฑ - GeoSphereAI{% endblock %}

{% block content %}
<div class="container">
    <h2>ุจุงุฑฺฏุฐุงุฑ ูุงู ZIP ุญุงู ุชุตุงูุฑ</h2>
    <p>ูุงู ZIP ุญุงู ุชุตุงูุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ ู ุชูุธูุงุช ููุฑุฏ ูุธุฑ ุฑุง ุงุนูุงู ฺฉูุฏ.</p>
    
    <!-- ููุงุด ูพุงูโูุง ุฎุทุง -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="alert alert-error">
        <div class="alert-icon">โ๏ธ</div>
        <div class="alert-content">
            <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
    {% endwith %}
    
    <form action="/zip-upload" method="POST" enctype="multipart/form-data">
        <!-- ุจุฎุด ุขูพููุฏ ูุงู ZIP -->
        <div class="upload-area">
            <input type="file" name="zip" id="zip" accept=".zip" required class="file-input">
            <label for="zip" class="file-label">
                <div class="upload-icon">๐</div>
                <div class="upload-text">
                    <strong>ุงูุชุฎุงุจ ูุงู ZIP</strong>
                    <span>ุง ูุงู ุฑุง ุงูุฌุง ุฑูุง ฺฉูุฏ</span>
                </div>
            </label>
        </div>

        <div class="settings-container">
            <h3>ุชูุธูุงุช ูพุฑุฏุงุฒุด</h3>
            
            <div class="toggle-group">
                <label class="toggle-label" for="classify_images">
                    <span class="toggle-content">
                        <span class="toggle-text">ุงูุฌุงู ุทุจููโุจูุฏ ุชุตูุฑ (Segformer)</span>
                        <span class="toggle-description">ุจุฑุง ุชุดุฎุต ู ุฌุฏุงุณุงุฒ ุงุฌุฒุง ูุฎุชูู ุชุตุงูุฑ</span>
                    </span>
                <input type="checkbox" class="toggle-input" id="classify_images" name="classify_images">
                <span class="toggle-switch"></span>
            </label>
        </div>
        <div class="input-group" id="segformer-model-group" style="display:none;">
            <label for="segformer_model">ุงูุชุฎุงุจ ูุฏู SegFormer</label>
            <div class="select-container">
                <select name="segformer_model" id="segformer_model" class="modern-select">
                    {% for val, label in segformer_models %}
                    <option value="{{ val }}" {% if loop.first %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="input-group">
            <label for="preselection_mode">ุญุงูุช ูพุดโุงูุชุฎุงุจ ูุฑุฌุน</label>
            <div class="select-container">
                <select name="preselection_mode" id="preselection_mode" class="modern-select">
                    <option value="source">ReferencePreselectionSource</option>
                    <option value="estimated">ReferencePreselectionEstimated</option>
                    <option value="sequential">ReferencePreselectionSequential</option>
                </select>
            </div>
        </div>

            <div class="toggle-group">
                <label class="toggle-label" for="generate_preview">
                    <span class="toggle-content">
                        <span class="toggle-text">ุชููุฏ ูุณุฎู ูพุดโููุงุด ุงุจุฑ ููุงุท</span>
                        <span class="toggle-description">ุญุฌู ฺฉูุชุฑ ุจุฑุง ููุงุด ุณุฑุนโุชุฑ</span>
                    </span>
                    <input type="checkbox" class="toggle-input" id="generate_preview" name="generate_preview" checked>
                    <span class="toggle-switch"></span>
                </label>
            </div>

            <div class="input-group">
                <label>ูุฑูุช ุงุจุฑ ููุงุท ุฎุฑูุฌ</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="export_ply" checked> PLY</label>
                    <label><input type="checkbox" name="export_pcd" checked> PCD</label>
                </div>
            </div>

            <div class="info-box">
                <div class="info-icon">๐ก</div>
                <div class="info-content">
                    <strong>ุฑุงูููุง ุงุณุชูุงุฏู:</strong>
                    <ul>
                        <li>ูุงู ZIP ุจุงุฏ ุญุงู ุชุตุงูุฑ ุจุง ูุฑูุช JPGุ PNGุ ุง JPEG ุจุงุดุฏ</li>
                        <li>ุญุฏุงฺฉุซุฑ ุญุฌู ูุงู: 100 ูฺฏุงุจุงุช</li>
                        <li>ุชุตุงูุฑ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูพุฑุฏุงุฒุด ู ุชุจุฏู ุจู ูุฏู ุณูโุจุนุฏ ูโุดููุฏ</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ุฏฺฉูู ุงุฑุณุงู -->
        <div class="submit-container">
            <button type="submit" class="submit-btn">
                <span class="btn-icon">๐</span>
                <span class="btn-text">ุจุงุฑฺฏุฐุงุฑ ู ุดุฑูุน ูพุฑุฏุงุฒุด</span>
            </button>
        </div>
    </form>
    
    <div class="navigation-links">
        <a href="{{ url_for('file_selection') }}" class="back-link">&larr; ุจุงุฒฺฏุดุช ุจู ุงูุชุฎุงุจ ููุน ูุงู</a>
    </div>
</div>

<script>
// File upload functionality
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('zip');
    const fileLabel = document.querySelector('.file-label');
    const classifyCheckbox = document.getElementById('classify_images');
    const modelGroup = document.getElementById('segformer-model-group');

    function toggleModelSelect() {
        modelGroup.style.display = classifyCheckbox.checked ? 'block' : 'none';
    }
    classifyCheckbox.addEventListener('change', toggleModelSelect);
    toggleModelSelect();
    
    // Drag and drop events
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileLabel.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        fileLabel.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        fileLabel.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight(e) {
        fileLabel.classList.add('drag-over');
    }
    
    function unhighlight(e) {
        fileLabel.classList.remove('drag-over');
    }
    
    fileLabel.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        // Check if file is ZIP
        if (files.length > 0 && files[0].name.toLowerCase().endsWith('.zip')) {
            fileInput.files = files;
            updateFileName();
        } else {
            alert('ูุทูุงู ููุท ูุงู ZIP ุงูุชุฎุงุจ ฺฉูุฏ');
        }
    }
    
    fileInput.addEventListener('change', updateFileName);
    
    function updateFileName() {
        const fileName = fileInput.files[0]?.name;
        if (fileName) {
            document.querySelector('.upload-text strong').textContent = fileName;
            document.querySelector('.upload-text span').textContent = 'ูุงู ุงูุชุฎุงุจ ุดุฏู';
            
            // Show file size
            const fileSize = fileInput.files[0].size;
            const fileSizeMB = (fileSize / (1024 * 1024)).toFixed(2);
            document.querySelector('.upload-text span').textContent = `ุญุฌู ูุงู: ${fileSizeMB} ูฺฏุงุจุงุช`;
        }
    }
    
    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const fileInput = document.getElementById('zip');
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('ูุทูุงู ูุงู ZIP ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ');
            return false;
        }
        
        const file = fileInput.files[0];
        const maxSize = 100 * 1024 * 1024; // 100MB
        
        if (file.size > maxSize) {
            e.preventDefault();
            alert('ุญุฌู ูุงู ูุจุงุฏ ุจุด ุงุฒ 100 ูฺฏุงุจุงุช ุจุงุดุฏ');
            return false;
        }
        
        if (!file.name.toLowerCase().endsWith('.zip')) {
            e.preventDefault();
            alert('ูุทูุงู ููุท ูุงู ZIP ุงูุชุฎุงุจ ฺฉูุฏ');
            return false;
        }
    });
});
</script>
{% endblock %}
